!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("rxjs"),require("three"),require("three/examples/jsm/loaders/GLTFLoader"),require("three/examples/jsm/loaders/DRACOLoader"),require("three/examples/jsm/controls/OrbitControls")):"function"==typeof define&&define.amd?define(["exports","rxjs","three","three/examples/jsm/loaders/GLTFLoader","three/examples/jsm/loaders/DRACOLoader","three/examples/jsm/controls/OrbitControls"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).gltfViewer={},e.rxjs,e.THREE,e.GLTFLoader,e.DRACOLoader,e.OrbitControls)}(this,(function(e,t,n,i,s,o){"use strict";function r(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var a=r(n);"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;function d(e,t,n){return e(n={path:t,exports:{},require:function(e,t){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==t&&n.path)}},n.exports),n.exports}var l=d((function(e,t){"undefined"!=typeof window&&window,e.exports=function(){if("undefined"==typeof window)return null;var e="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")(),t=e.requestAnimationFrame||e.mozRequestAnimationFrame||e.webkitRequestAnimationFrame||function(t){return e.setTimeout(t,20)},n=e.cancelAnimationFrame||e.mozCancelAnimationFrame||e.webkitCancelAnimationFrame||function(t){e.clearTimeout(t)};function i(e,t){var n=Object.prototype.toString.call(e),i="[object Array]"===n||"[object NodeList]"===n||"[object HTMLCollection]"===n||"[object Object]"===n||"undefined"!=typeof jQuery&&e instanceof jQuery||"undefined"!=typeof Elements&&e instanceof Elements,s=0,o=e.length;if(i)for(;s<o;s++)t(e[s]);else t(e)}function s(e){if(!e.getBoundingClientRect)return{width:e.offsetWidth,height:e.offsetHeight};var t=e.getBoundingClientRect();return{width:Math.round(t.width),height:Math.round(t.height)}}function o(e,t){Object.keys(t).forEach((function(n){e.style[n]=t[n]}))}var r=function(e,a){var d=0;function l(){var e,t,n=[];this.add=function(e){n.push(e)},this.call=function(i){for(e=0,t=n.length;e<t;e++)n[e].call(this,i)},this.remove=function(i){var s=[];for(e=0,t=n.length;e<t;e++)n[e]!==i&&s.push(n[e]);n=s},this.length=function(){return n.length}}function h(e,n){if(e)if(e.resizedAttached)e.resizedAttached.add(n);else{e.resizedAttached=new l,e.resizedAttached.add(n),e.resizeSensor=document.createElement("div"),e.resizeSensor.dir="ltr",e.resizeSensor.className="resize-sensor";var i={pointerEvents:"none",position:"absolute",left:"0px",top:"0px",right:"0px",bottom:"0px",overflow:"hidden",zIndex:"-1",visibility:"hidden",maxWidth:"100%"},r={position:"absolute",left:"0px",top:"0px",transition:"0s"};o(e.resizeSensor,i);var a=document.createElement("div");a.className="resize-sensor-expand",o(a,i);var h=document.createElement("div");o(h,r),a.appendChild(h);var c=document.createElement("div");c.className="resize-sensor-shrink",o(c,i);var u=document.createElement("div");o(u,r),o(u,{width:"200%",height:"200%"}),c.appendChild(u),e.resizeSensor.appendChild(a),e.resizeSensor.appendChild(c),e.appendChild(e.resizeSensor);var m=window.getComputedStyle(e),f=m?m.getPropertyValue("position"):null;"absolute"!==f&&"relative"!==f&&"fixed"!==f&&"sticky"!==f&&(e.style.position="relative");var g=!1,p=0,_=s(e),v=0,w=0,S=!0;d=0;var M=function(){var t=e.offsetWidth,n=e.offsetHeight;h.style.width=t+10+"px",h.style.height=n+10+"px",a.scrollLeft=t+10,a.scrollTop=n+10,c.scrollLeft=t+10,c.scrollTop=n+10},y=function(){if(S){if(0===e.offsetWidth&&0===e.offsetHeight)return void(d||(d=t((function(){d=0,y()}))));S=!1}M()};e.resizeSensor.resetSensor=y;var b=function(){p=0,g&&(v=_.width,w=_.height,e.resizedAttached&&e.resizedAttached.call(_))},C=function(){_=s(e),(g=_.width!==v||_.height!==w)&&!p&&(p=t(b)),y()},x=function(e,t,n){e.attachEvent?e.attachEvent("on"+t,n):e.addEventListener(t,n)};x(a,"scroll",C),x(c,"scroll",C),d=t((function(){d=0,y()}))}}i(e,(function(e){h(e,a)})),this.detach=function(t){d||(n(d),d=0),r.detach(e,t)},this.reset=function(){e.resizeSensor.resetSensor()}};if(r.reset=function(e){i(e,(function(e){e.resizeSensor.resetSensor()}))},r.detach=function(e,t){i(e,(function(e){e&&(e.resizedAttached&&"function"==typeof t&&(e.resizedAttached.remove(t),e.resizedAttached.length())||e.resizeSensor&&(e.contains(e.resizeSensor)&&e.removeChild(e.resizeSensor),delete e.resizeSensor,delete e.resizedAttached))}))},"undefined"!=typeof MutationObserver){var a=new MutationObserver((function(e){for(var t in e)if(e.hasOwnProperty(t))for(var n=e[t].addedNodes,i=0;i<n.length;i++)n[i].resizeSensor&&r.reset(n[i])}));document.addEventListener("DOMContentLoaded",(function(e){a.observe(document.body,{childList:!0,subtree:!0})}))}return r}()})),h=d((function(e,t){"undefined"!=typeof window&&window,e.exports=function(e){var t=function(){var t,n={},i=[];function s(e){e||(e=document.documentElement);var t=window.getComputedStyle(e,null).fontSize;return parseFloat(t)||16}function o(e){if(!e.getBoundingClientRect)return{width:e.offsetWidth,height:e.offsetHeight};var t=e.getBoundingClientRect();return{width:Math.round(t.width),height:Math.round(t.height)}}function r(e,t){var n=t.split(/\d/),i=n[n.length-1];switch(t=parseFloat(t),i){case"px":return t;case"em":return t*s(e);case"rem":return t*s();case"vw":return t*document.documentElement.clientWidth/100;case"vh":return t*document.documentElement.clientHeight/100;case"vmin":case"vmax":var o=document.documentElement.clientWidth/100,r=document.documentElement.clientHeight/100;return t*(0,Math["vmin"===i?"min":"max"])(o,r);default:return t}}function a(e,t){var i,s,a,d,l,h,c,u;this.element=e;var m=["min-width","min-height","max-width","max-height"];this.call=function(){for(i in a=o(this.element),h={},n[t])n[t].hasOwnProperty(i)&&(s=n[t][i],d=r(this.element,s.value),l="width"===s.property?a.width:a.height,u=s.mode+"-"+s.property,c="","min"===s.mode&&l>=d&&(c+=s.value),"max"===s.mode&&l<=d&&(c+=s.value),h[u]||(h[u]=""),c&&-1===(" "+h[u]+" ").indexOf(" "+c+" ")&&(h[u]+=" "+c));for(var e in m)m.hasOwnProperty(e)&&(h[m[e]]?this.element.setAttribute(m[e],h[m[e]].substr(1)):this.element.removeAttribute(m[e]))}}function d(t,n){t.elementQueriesSetupInformation||(t.elementQueriesSetupInformation=new a(t,n)),t.elementQueriesSensor||(t.elementQueriesSensor=new e(t,(function(){t.elementQueriesSetupInformation.call()})))}function l(e,s,o,r){if(void 0===n[e]){n[e]=[];var a=i.length;t.innerHTML+="\n"+e+" {animation: 0.1s element-queries;}",t.innerHTML+="\n"+e+" > .resize-sensor {min-width: "+a+"px;}",i.push(e)}n[e].push({mode:s,property:o,value:r})}function h(e){var t;if(document.querySelectorAll&&(t=e?e.querySelectorAll.bind(e):document.querySelectorAll.bind(document)),t||"undefined"==typeof $$||(t=$$),t||"undefined"==typeof jQuery||(t=jQuery),!t)throw"No document.querySelectorAll, jQuery or Mootools's $$ found.";return t}function c(e){var t=h(e);for(var i in n)if(n.hasOwnProperty(i))for(var s=t(i,e),o=0,r=s.length;o<r;o++)d(s[o],i)}function u(t){var n=[],i=[],s=[],o=0,r=-1,a=[];for(var d in t.children)if(t.children.hasOwnProperty(d)&&t.children[d].tagName&&"img"===t.children[d].tagName.toLowerCase()){n.push(t.children[d]);var l=t.children[d].getAttribute("min-width")||t.children[d].getAttribute("data-min-width"),h=t.children[d].getAttribute("data-src")||t.children[d].getAttribute("url");s.push(h);var c={minWidth:l};i.push(c),l?t.children[d].style.display="none":(o=n.length-1,t.children[d].style.display="block")}function u(){var e,d=!1;for(e in n)n.hasOwnProperty(e)&&i[e].minWidth&&t.offsetWidth>i[e].minWidth&&(d=e);if(d||(d=o),r!==d)if(a[d])n[r].style.display="none",n[d].style.display="block",r=d;else{var l=new Image;l.onload=function(){n[d].src=s[d],n[r].style.display="none",n[d].style.display="block",a[d]=!0,r=d},l.src=s[d]}else n[d].src=s[d]}r=o,t.resizeSensorInstance=new e(t,u),u()}function m(){for(var e=h()("[data-responsive-image],[responsive-image]"),t=0,n=e.length;t<n;t++)u(e[t])}var f=/,?[\s\t]*([^,\n]*?)((?:\[[\s\t]*?(?:min|max)-(?:width|height)[\s\t]*?[~$\^]?=[\s\t]*?"[^"]*?"[\s\t]*?])+)([^,\n\s\{]*)/gim,g=/\[[\s\t]*?(min|max)-(width|height)[\s\t]*?[~$\^]?=[\s\t]*?"([^"]*?)"[\s\t]*?]/gim;function p(e){var t,n,i,s;for(e=e.replace(/'/g,'"');null!==(t=f.exec(e));)for(n=t[1]+t[3],i=t[2];null!==(s=g.exec(i));)l(n,s[1],s[2],s[3])}function _(e){var t="";if(e)if("string"==typeof e)-1===(e=e.toLowerCase()).indexOf("min-width")&&-1===e.indexOf("max-width")||p(e);else for(var n=0,i=e.length;n<i;n++)1===e[n].type?-1!==(t=e[n].selectorText||e[n].cssText).indexOf("min-height")||-1!==t.indexOf("max-height")?p(t):-1===t.indexOf("min-width")&&-1===t.indexOf("max-width")||p(t):4===e[n].type?_(e[n].cssRules||e[n].rules):3===e[n].type&&e[n].styleSheet.hasOwnProperty("cssRules")&&_(e[n].styleSheet.cssRules)}var v=!1;this.init=function(){var n="animationstart";void 0!==document.documentElement.style.webkitAnimationName?n="webkitAnimationStart":void 0!==document.documentElement.style.MozAnimationName?n="mozanimationstart":void 0!==document.documentElement.style.OAnimationName&&(n="oanimationstart"),document.body.addEventListener(n,(function(t){var n=t.target,s=n&&window.getComputedStyle(n,null),o=s&&s.getPropertyValue("animation-name");if(o&&-1!==o.indexOf("element-queries")){n.elementQueriesSensor=new e(n,(function(){n.elementQueriesSetupInformation&&n.elementQueriesSetupInformation.call()}));var r=window.getComputedStyle(n.resizeSensor,null).getPropertyValue("min-width");r=parseInt(r.replace("px","")),d(t.target,i[r])}})),v||((t=document.createElement("style")).type="text/css",t.innerHTML="[responsive-image] > img, [data-responsive-image] {overflow: hidden; padding: 0; } [responsive-image] > img, [data-responsive-image] > img {width: 100%;}",t.innerHTML+="\n@keyframes element-queries { 0% { visibility: inherit; } }",document.getElementsByTagName("head")[0].appendChild(t),v=!0);for(var s=0,o=document.styleSheets.length;s<o;s++)try{document.styleSheets[s].href&&0===document.styleSheets[s].href.indexOf("file://")&&console.warn("CssElementQueries: unable to parse local css files, "+document.styleSheets[s].href),_(document.styleSheets[s].cssRules||document.styleSheets[s].rules||document.styleSheets[s].cssText)}catch(e){}m()},this.findElementQueriesElements=function(e){c(e)},this.update=function(){this.init()}};t.update=function(){t.instance.update()},t.detach=function(e){e.elementQueriesSetupInformation?(e.elementQueriesSensor.detach(),delete e.elementQueriesSetupInformation,delete e.elementQueriesSensor):e.resizeSensorInstance&&(e.resizeSensorInstance.detach(),delete e.resizeSensorInstance)},t.init=function(){t.instance||(t.instance=new t),t.instance.init()};var n=function(e){if(document.addEventListener)document.addEventListener("DOMContentLoaded",e,!1);else if(/KHTML|WebKit|iCab/i.test(navigator.userAgent))var t=setInterval((function(){/loaded|complete/i.test(document.readyState)&&(e(),clearInterval(t))}),10);else window.onload=e};return t.findElementQueriesElements=function(e){t.instance.findElementQueriesElements(e)},t.listen=function(){n(t.init)},t}(l)})),c={ResizeSensor:l,ElementQueries:h},u=function(e,t,n,i){return new(n||(n=Promise))((function(s,o){function r(e){try{d(i.next(e))}catch(e){o(e)}}function a(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,a)}d((i=i.apply(e,t||[])).next())}))};class m{constructor(e=null){this.dracoDecoderEnabled=!0,this.dracoDecoderPath="/assets/draco/",null!=e&&Object.assign(this,e)}}e.GltfViewer=class{constructor(e,n){if(this._initialized=new t.BehaviorSubject(!1),this._modelLoadingStateChange=new t.Subject,this._modelLoadingStart=new t.Subject,this._modelLoadingProgress=new t.Subject,this._modelLoadingEnd=new t.Subject,this._openedModelsChange=new t.Subject,this._selectionChange=new t.Subject,this._manualSelectionChange=new t.Subject,this._bakMatProp="materialBackup",this._selectedProp="selected",this._isolatedProp="isolated",this._subscriptions=[],this._selectedMeshes=[],this._isolatedMeshes=[],this._pickingColorToMesh=new Map,this._lastPickingColor=0,this._pointerEventHelper={downX:null,downY:null,maxDiff:10,waitForDouble:!1},this._loadingInProgress=!1,this._loadingQueue=[],this._loadedModelsByGuid=new Map,this._loadedMeshesById=new Map,this._onCanvasPointerDown=e=>{this._pointerEventHelper.downX=e.clientX,this._pointerEventHelper.downY=e.clientY},this._onCanvasPointerUp=e=>{const t=e.clientX,n=e.clientY;!this._pointerEventHelper.downX||Math.abs(t-this._pointerEventHelper.downX)>this._pointerEventHelper.maxDiff||Math.abs(n-this._pointerEventHelper.downY)>this._pointerEventHelper.maxDiff||(this._pointerEventHelper.waitForDouble?(this._selectedMeshes.length&&(this.isolateSelectedMeshes(),this.fitCameraToObjects(this._selectedMeshes)),this._pointerEventHelper.waitForDouble=!1):(this._pointerEventHelper.waitForDouble=!0,setTimeout(()=>{this._pointerEventHelper.waitForDouble=!1},300),this.selectMeshAtPoint(t,n)),this._pointerEventHelper.downX=null,this._pointerEventHelper.downY=null)},this._container=document.getElementById(e),!this._container)throw new Error("Container not found!");this._options=new m(n),this.init()}init(){this._containerResizeSensor=new c.ResizeSensor(this._container,()=>{this.updateContainerDimensions(),this.updateRendererSize()}),this.initObservables(),this.initRendererWithScene(),this.initSpecialMaterials(),this.initPickingScene(),this.initLoader(),this._initialized.next(!0)}destroy(){var e;this._subscriptions.forEach(e=>e.unsubscribe()),this.closeSubjects(),this._renderer&&this._renderer.dispose(),this._orbitControls&&this._orbitControls.dispose(),(null===(e=this._loader)||void 0===e?void 0:e.dracoLoader)&&this._loader.dracoLoader.dispose(),this._containerResizeSensor&&this._containerResizeSensor.detach()}openModel(e){(null==e?void 0:e.guid)&&(this._loadingQueue.push(e),this.loadQueuedModelsAsync())}closeModel(e){e&&this.removeModelFromScene(e)}selectItems(e){if(null==e?void 0:e.length){const{found:t,notFound:n}=this.findMeshesByIds(new Set(e));t.length&&this.selectMeshes(t,!1)}}isolateItems(e){if(null==e?void 0:e.length){const{found:t,notFound:n}=this.findMeshesByIds(new Set(e));t.length&&this.selectMeshes(t,!1,!0)}}initObservables(){this.initialized$=this._initialized.asObservable(),this.modelLoadingStateChange$=this._modelLoadingStateChange.asObservable(),this.modelLoadingStart$=this._modelLoadingStart.asObservable(),this.modelLoadingProgress$=this._modelLoadingProgress.asObservable(),this.modelLoadingEnd$=this._modelLoadingEnd.asObservable(),this.openedModelsChange$=this._openedModelsChange.asObservable(),this.selectionChange$=this._selectionChange.asObservable(),this.manualSelectionChange$=this._manualSelectionChange.asObservable()}closeSubjects(){this._initialized.complete(),this._modelLoadingStateChange.complete(),this._modelLoadingStart.complete(),this._modelLoadingProgress.complete(),this._modelLoadingEnd.complete(),this._openedModelsChange.complete(),this._selectionChange.complete(),this._manualSelectionChange.complete()}initRendererWithScene(){const e=new a.default.Scene,t=new a.default.AmbientLight(2236962,1),n=new a.default.HemisphereLight(16777147,526368,1);n.translateY(2e3),e.add(t),e.add(n);const i=new a.default.WebGLRenderer({alpha:!0,antialias:!0});i.setSize(this._containerWidth,this._containerHeight,!1),i.setClearColor(0,0),i.outputEncoding=a.default.sRGBEncoding,i.physicallyCorrectLights=!1,i.toneMapping=a.default.NoToneMapping;const s=new a.default.PerspectiveCamera(75,this._containerWidth/this._containerHeight,.01,1e4),r=new o.OrbitControls(s,i.domElement);r.addEventListener("change",()=>this.render()),s.position.set(0,1e3,1e3),s.lookAt(0,0,0),r.update(),this._container.append(i.domElement),this._renderer=i,this._mainScene=e,this._camera=s,this._orbitControls=r,this.render()}initSpecialMaterials(){const e=new a.default.MeshPhysicalMaterial({color:new a.default.Color(16711680),emissive:new a.default.Color(16711680),blending:a.default.NormalBlending,flatShading:!0,side:a.default.DoubleSide,roughness:1,metalness:0}),t=new a.default.MeshPhysicalMaterial({color:new a.default.Color(16776960),emissive:new a.default.Color(0),blending:a.default.NormalBlending,flatShading:!0,side:a.default.DoubleSide,roughness:1,metalness:0}),n=new a.default.MeshPhysicalMaterial({color:new a.default.Color(5592405),emissive:new a.default.Color(0),blending:a.default.NormalBlending,flatShading:!0,side:a.default.DoubleSide,roughness:1,metalness:0,opacity:.2,transparent:!0});this._selectionMaterial=e,this._highlightMaterial=t,this._isolateMaterial=n}render(){this._renderer&&requestAnimationFrame(()=>this._renderer.render(this._mainScene,this._camera))}fitCameraToObjects(e,t=1.2){if(!(null==e?void 0:e.length))return;const n=new a.default.Box3;for(const t of e)n.expandByObject(t);const i=n.getSize(new a.default.Vector3),s=n.getCenter(new a.default.Vector3),o=Math.max(i.x,i.y,i.z)/(2*Math.atan(Math.PI*this._camera.fov/360)),r=o/this._camera.aspect,d=t*Math.max(o,r),l=this._orbitControls.target.clone().sub(this._camera.position).normalize().multiplyScalar(d);this._orbitControls.maxDistance=Math.max(10*d,1e4),this._orbitControls.target.copy(s),this._camera.near=Math.min(d/100,.01),this._camera.far=Math.max(100*d,1e4),this._camera.updateProjectionMatrix(),this._camera.position.copy(this._orbitControls.target).sub(l),this._orbitControls.update()}initPickingScene(){const e=new a.default.WebGLRenderTarget(1,1),t=new a.default.Scene;t.background=new a.default.Color(0),this._pickingTarget=e,this._pickingScene=t,this._renderer.domElement.addEventListener("pointerdown",this._onCanvasPointerDown),this._renderer.domElement.addEventListener("pointerup",this._onCanvasPointerUp)}nextPickingColor(){return++this._lastPickingColor}addMeshToPickingScene(e){const t=new a.default.MeshStandardMaterial({color:new a.default.Color(this.nextPickingColor()),emissive:new a.default.Color(this._lastPickingColor),blending:a.default.NoBlending,flatShading:!0,side:a.default.DoubleSide,roughness:1,metalness:0}),n=this._lastPickingColor.toString(16),i=new a.default.Mesh(e.geometry,t);i.userData.originalUuid=e.uuid,i.userData.color=n,i.position.copy(e.position),i.rotation.copy(e.rotation),i.scale.copy(e.scale),this._pickingScene.add(i),this._pickingColorToMesh.set(n,e)}removeMeshFromPickingScene(e){const t=this._pickingScene.children.find(t=>t.userData.originalUuid===e.uuid);t&&(this._pickingScene.remove(t),this._pickingColorToMesh.delete(t.userData.color))}getPickingPosition(e,t){const n=this._renderer.domElement.getBoundingClientRect();return{x:(e-n.left)*this._renderer.domElement.width/n.width,y:(t-n.top)*this._renderer.domElement.height/n.height}}getItemAtPickingPosition(e){const t=this._renderer.getPixelRatio();this._camera.setViewOffset(this._renderer.getContext().drawingBufferWidth,this._renderer.getContext().drawingBufferHeight,e.x*t||0,e.y*t||0,1,1);const n=new a.default.DirectionalLight(16777215,1);n.position.set(-1,2,4),this._camera.add(n),this._renderer.setRenderTarget(this._pickingTarget),this._renderer.render(this._pickingScene,this._camera),this._renderer.setRenderTarget(null),this._camera.clearViewOffset(),this._camera.remove(n);const i=new Uint8Array(4);this._renderer.readRenderTargetPixels(this._pickingTarget,0,0,1,1,i);const s=i[0]<<16|i[1]<<8|i[2];return this._pickingColorToMesh.get(s.toString(16))}updateContainerDimensions(){const e=this._container.getBoundingClientRect();this._containerWidth=e.width,this._containerHeight=e.height}updateRendererSize(){this._renderer&&(this._camera.aspect=this._containerWidth/this._containerHeight,this._camera.updateProjectionMatrix(),this._renderer.setSize(this._containerWidth,this._containerHeight,!1),this.render())}initLoader(){const e=new i.GLTFLoader;if(this._options.dracoDecoderEnabled){const t=new s.DRACOLoader;t.setDecoderPath(this._options.dracoDecoderPath),t.preload(),e.setDRACOLoader(t)}this._loader=e,this.loadQueuedModelsAsync()}loadQueuedModelsAsync(){return u(this,void 0,void 0,(function*(){if(this._loader&&!this._loadingInProgress){for(this._loadingInProgress=!0,this._modelLoadingStateChange.next(!0);this._loadingQueue.length>0;){const{url:e,guid:t,name:n}=this._loadingQueue.shift();this._loadedModelsByGuid.has(t)||(yield this.loadModel(e,t,n))}this._loadingInProgress=!1,this._modelLoadingStateChange.next(!1)}}))}loadModel(e,t,n){return u(this,void 0,void 0,(function*(){this.onModelLoadingStart(e,t);try{const i=yield this._loader.loadAsync(e,e=>this.onModelLoadingProgress(e));this.addModelToScene(i,t,n),this.onModelLoadingEnd(e,t)}catch(n){this.onModelLoadingEnd(e,t,n)}}))}onModelLoadingStart(e,t){this._modelLoadingStart.next({url:e,guid:t})}onModelLoadingProgress(e){const t=Math.round(e.loaded/e.total*100);this._modelLoadingProgress.next(t)}onModelLoadingEnd(e,t,n=null){n&&console.log(n),this._modelLoadingProgress.next(0),this._modelLoadingEnd.next({url:e,guid:t,error:n})}addModelToScene(e,t,n){if(!this._mainScene)return;const i=n||t,s=e.scene;s.userData.guid=t,s.name=i;const o=[],r=new Set;s.traverse(e=>{if(e instanceof a.default.Mesh){const n=`${t}|${e.name}`;e.userData.id=n,o.push(e),r.add(e.name),this._loadedMeshesById.has(n)?this._loadedMeshesById.get(n).push(e):this._loadedMeshesById.set(n,[e]),this.addMeshToPickingScene(e)}}),this._mainScene.add(s),this._loadedModelsByGuid.set(t,{gltf:e,meshes:o,handles:r,name:i}),this.emitOpenedModelsChanged(),this.fitCameraToObjects([this._mainScene]),this.render()}removeModelFromScene(e){if(!this._mainScene||!this._loadedModelsByGuid.has(e))return;const t=this._loadedModelsByGuid.get(e);t.meshes.forEach(e=>{this._loadedMeshesById.delete(e.userData.id),this.removeMeshFromPickingScene(e)}),this._mainScene.remove(t.gltf.scene),this._loadedModelsByGuid.delete(e),this.emitOpenedModelsChanged(),this.render()}emitOpenedModelsChanged(){const e=new Map;for(const[t,n]of this._loadedModelsByGuid)e.set(t,{name:n.name,handles:n.handles});this._openedModelsChange.next(e)}findMeshesByIds(e){const t=[],n=new Set;return e.forEach(e=>{this._loadedMeshesById.has(e)?t.push(...this._loadedMeshesById.get(e)):n.add(e)}),{found:t,notFound:n}}removeSelection(){for(const e of this._selectedMeshes)e.material=e[this._bakMatProp],e[this._selectedProp]=void 0;this._selectedMeshes.length=0}removeIsolation(){for(const e of this._isolatedMeshes)e.material=e[this._bakMatProp],e[this._isolatedProp]=void 0;this._isolatedMeshes.length=0}selectMeshAtPoint(e,t){const n=this.getPickingPosition(e,t),i=this.getItemAtPickingPosition(n);i?this.selectMeshes([i],!0):this.selectMeshes([],!0)}addToSelection(e){if(!e||this._selectedMeshes.includes(e))return!1;const t=[e,...this._selectedMeshes];return this.selectMeshes(t,!0),!0}removeFromSelection(e){if(!e||!this._selectedMeshes.includes(e))return!1;const t=this._selectedMeshes.filter(t=>t!==e);return this.selectMeshes(t,!0),!0}selectMeshes(e,t,n=!1){if(this.removeSelection(),this.removeIsolation(),!(null==e?void 0:e.length))return this.emitSelectionChanged(t),null;e.forEach(e=>{e[this._bakMatProp]||(e[this._bakMatProp]=e.material),e[this._selectedProp]=!0,e.material=this._selectionMaterial}),n&&this.isolateSelectedMeshes(),this._selectedMeshes=e,this.emitSelectionChanged(t)}isolateSelectedMeshes(){[...this._loadedMeshesById.values()].flatMap(e=>e).forEach(e=>{e[this._selectedProp]||(e[this._bakMatProp]||(e[this._bakMatProp]=e.material),e[this._isolatedProp]=!0,e.material=this._isolateMaterial,this._isolatedMeshes.push(e))})}emitSelectionChanged(e){e||this.fitCameraToObjects(this._selectedMeshes),this.render();const t=new Set;this._selectedMeshes.forEach(e=>t.add(e.userData.id)),this._selectionChange.next(t),e&&this._manualSelectionChange.next(t)}},e.GltfViewerOptions=m,Object.defineProperty(e,"__esModule",{value:!0})}));
